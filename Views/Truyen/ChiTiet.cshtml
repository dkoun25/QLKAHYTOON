@model QLKAHYTOON.Models.thongtintruyen
@{
    ViewBag.Title = Model.TenTruyen;
    var danhSachChuong = ViewBag.DanhSachChuong as List<QLKAHYTOON.Models.chuong>;
    // Lấy danh sách thể loại từ Controller
    var danhSachTheLoai = ViewBag.DanhSachTheLoai as List<QLKAHYTOON.Models.theloai>;
}

<style>
    .comic-detail-card {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-top: 20px;
    }

    .chapter-list {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #eee;
        padding: 10px;
    }

    /* Style cho link thể loại */
    .genre-link {
        margin-right: 5px;
        color: #e50914; /* Màu đỏ hoặc màu chủ đạo của web */
        text-decoration: none;
    }

        .genre-link:hover {
            text-decoration: underline;
        }
</style>

<h2>@Model.TenTruyen</h2>

<div class="row">
    <div class="col-md-4">
        <img src="@Model.AnhTruyen" class="img-responsive thumbnail" alt="@Model.TenTruyen" style="width:100%" />
    </div>
    <div class="col-md-8">
        <h3>Thông tin chi tiết</h3>
        <ul class="list-group">
            <li class="list-group-item"><strong>Tác giả:</strong> @Model.TacGia</li>

            <li class="list-group-item">
                <strong>Thể loại:</strong>
                @if (danhSachTheLoai != null && danhSachTheLoai.Any())
                {
                    foreach (var tl in danhSachTheLoai)
                    {
                        <a href="@Url.Action("TheLoai", "Home", new { id = tl.MaTheLoai.Trim() })" class="genre-link">
                            @tl.TenTheLoai
                        </a>
                        // Thêm dấu phẩy nếu không phải phần tử cuối
                        if (tl != danhSachTheLoai.Last())
                        {
                            <span>, </span>
                        }
                    }
                }
                else
                {
                    <span>Chưa cập nhật</span>
                }
            </li>
            <li class="list-group-item"><strong>Trạng thái:</strong> @Model.TrangThai</li>
            <li class="list-group-item">
                <strong>Ngày đăng:</strong>
                @(Model.NgayDang.HasValue ? Model.NgayDang.Value.ToString("dd/MM/yyyy") : "N/A")
            </li>
        </ul>

        <a href="#" class="btn btn-success">Theo dõi</a>

        @if (danhSachChuong != null && danhSachChuong.Any())
        {
            <a href="@Url.Action("DocTruyen", "Truyen", new { id = danhSachChuong.First().MaChuong.Trim() })" class="btn btn-primary">Đọc từ đầu</a>
        }
    </div>
</div>

<div class="row comic-detail-card">
    <div class="col-md-12">
        <h3><span class="glyphicon glyphicon-list"></span> Danh sách chương</h3>
        <hr />
        <div class="list-group chapter-list">
            @if (danhSachChuong != null && danhSachChuong.Any())
            {
                foreach (var chuong in danhSachChuong)
                {
                    <a href="@Url.Action("DocTruyen", "Truyen", new { id = chuong.MaChuong.Trim() })" class="list-group-item">
                        Chương @chuong.SoChuong - @chuong.TenChuong
                        <span class="pull-right">
                            @(chuong.NgayDang.HasValue ? chuong.NgayDang.Value.ToString("dd/MM/yyyy") : "")
                        </span>
                    </a>
                }
            }
            else
            {
                <p>Truyện chưa có chương nào.</p>
            }
        </div>
    </div>
</div>